<div class="modal-header">
  <h2 mat-dialog-title>
    <mat-icon>{{ sucursalSeleccionada ? 'inventory' : 'business' }}</mat-icon>
    {{ sucursalSeleccionada ? 'Productos de ' + sucursalSeleccionada.nombre : 'Sucursales' }}
  </h2>
</div>

<div mat-dialog-content class="modal-content">
  <!-- Vista de Sucursales -->
  <div *ngIf="!sucursalSeleccionada">
    <div *ngIf="cargando" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando sucursales...</p>
    </div>
    
    <div *ngIf="error && !cargando" class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>Error al cargar las sucursales</p>
      <button mat-button color="primary" (click)="recargarSucursales()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>
    
    <div *ngIf="!cargando && !error && sucursales.length > 0" class="sucursales-container">
      <div *ngFor="let sucursal of sucursales" 
           class="sucursal-item" 
           (click)="seleccionarSucursal(sucursal)"
           role="button"
           tabindex="0"
           (keydown.enter)="seleccionarSucursal(sucursal)"
           (keydown.space)="seleccionarSucursal(sucursal)">
        <div class="sucursal-header">
          <h3>{{ sucursal.nombre }}</h3>
          <mat-icon>location_on</mat-icon>
        </div>
        <div class="sucursal-info">
          <p><strong>ID:</strong> {{ sucursal.id }}</p>
          <p><strong>Ciudad:</strong> {{ sucursal.ciudad }}</p>
        </div>
        <div class="sucursal-actions">
          <mat-icon>arrow_forward_ios</mat-icon>
        </div>
      </div>
    </div>
    
    <div *ngIf="!cargando && !error && sucursales.length === 0" class="no-data">
      <mat-icon>info</mat-icon>
      <p>No se encontraron sucursales</p>
    </div>
  </div>

  <!-- Vista de Productos -->
  <div *ngIf="sucursalSeleccionada">
    <div *ngIf="cargandoProductos" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando productos...</p>
    </div>
    <div *ngIf="errorProductos && !cargandoProductos" class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>Error al cargar los productos</p>
      <button mat-button color="primary" (click)="recargarProductos()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>
    
    <div *ngIf="!cargandoProductos && !errorProductos && productos.length > 0" class="productos-container">
      <div *ngFor="let producto of productos; let i = index" class="producto-item">
        <div class="producto-header">
          <h4>{{ producto.nombre }}</h4>
          <span class="tipo-badge">{{ producto.tipoProducto }}</span>
        </div>
        <div class="producto-info">
          <h4>{{ producto.nombre }}</h4>
          <p><strong>ID:</strong> {{ producto.id }}</p>
          <p><strong>Monto Mínimo:</strong> {{ producto.montoMinimo | currency:'COL':'symbol':'1.0-0' }}</p>
          <div class="saldo-disponible" *ngIf="cliente">
            <p><strong>Saldo Disponible:</strong> 
              <span class="saldo-amount">{{ cliente.monto | currency:'COL':'symbol':'1.2-2' }}</span>
            </p>
          </div>
        </div>
        <div class="producto-actions">
          <div class="input-container">
            <input type="number" 
                   class="monto-input"
                   [class.error]="montosInversion[i] && !validarMonto(montosInversion[i], producto)"
                   placeholder="Monto a invertir"
                   [(ngModel)]="montosInversion[i]"
                   [min]="producto.montoMinimo"
                   [max]="obtenerMontoMaximo()">
            <div class="error-message" 
                 *ngIf="montosInversion[i] && !validarMonto(montosInversion[i], producto)">
              {{ obtenerMensajeErrorMonto(montosInversion[i], producto) }}
            </div>
          </div>
          <button mat-raised-button 
                  color="primary" 
                  class="invertir-button"
                  (click)="invertir(producto, montosInversion[i])"
                  [disabled]="!montosInversion[i] || !validarMonto(montosInversion[i], producto)">
            <mat-icon>trending_up</mat-icon>
            Invertir
          </button>
        </div>
      </div>
    </div>
    
    <div *ngIf="!cargandoProductos && !errorProductos && productos.length === 0" class="no-data">
      <mat-icon>inventory_2</mat-icon>
      <p>No se encontraron productos para esta sucursal</p>
    </div>
  </div>
</div>

<div mat-dialog-actions class="modal-actions">
  <button *ngIf="sucursalSeleccionada" 
          mat-button 
          (click)="volverASucursales()" 
          class="back-button-footer"
          matTooltip="Volver a sucursales">
    <mat-icon>arrow_back</mat-icon>
    Atrás
  </button>
  <div class="spacer"></div>
  <button mat-button mat-dialog-close>Cerrar</button>
</div>